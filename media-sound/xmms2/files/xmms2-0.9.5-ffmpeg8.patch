https://github.com/xmms2/xmms2-devel/pull/63
--- a/src/plugins/avcodec/avcodec.c
+++ b/src/plugins/avcodec/avcodec.c
@@ -131,6 +131,5 @@
 	g_return_if_fail (data);
 
-	avcodec_close (data->codecctx);
-	av_free (data->codecctx);
+	avcodec_free_context (&(data->codecctx));
 	av_frame_free (&data->read_out_frame);
 
@@ -252,5 +251,4 @@
 		} else {
 			XMMS_DBG ("First read failed, codec is not working...");
-			avcodec_close (data->codecctx);
 			goto err;
 		}
@@ -261,5 +259,4 @@
 	data->sampleformat = xmms_avcodec_translate_sample_format (data->codecctx->sample_fmt);
 	if (data->sampleformat == XMMS_SAMPLE_FORMAT_UNKNOWN) {
-		avcodec_close (data->codecctx);
 		goto err;
 	}
@@ -285,5 +282,5 @@
 err:
 	if (data->codecctx) {
-		av_free (data->codecctx);
+		avcodec_free_context (&(data->codecctx));
 	}
 	if (data->read_out_frame) {
